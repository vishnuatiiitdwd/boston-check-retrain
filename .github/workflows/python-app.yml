name: Retrain ML Model

on:
  workflow_dispatch:  # Allows manual triggering from the GitHub Actions UI
  push:
    paths:
      - "notebooks/train_model.ipynb"
      - "data/**"
      - ".github/workflows/retrain.yml"

jobs:
  retrain:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install nbconvert jupyter pandas scikit-learn

    - name: Convert notebook to script
      run: |
        jupyter nbconvert --to script lrmi.ipynb --output train_model

    - name: Run training script
      run: |
        python notebooks/train_model.py

    - name: List model files
      run: ls -lh models/

    - name: Upload trained model
      uses: actions/upload-artifact@v3.1.3
      with:
        name: trained-model
        path: models/trained_model.pkl
